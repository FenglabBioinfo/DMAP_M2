#Preparing the reference file and index file
bwa index gmx.fa
samtools faidx gmx.fa
java -jar picard.jar CreateSequenceDictionary R=gmx.fa O=gmx.dict

#Quality-trimming
fastp -q 20 -u 50 -n 15 -l 50 -w 4 -i S1_raw_1.fq.gz -I S1_raw_1.fq.gz -o S1_filter_1.fq.gz -O S1_filter_2.fq.gz -j S1.json -h S1.html

#alige the reads tp reference sequence
bwa mem -t 4 -M -k 32 -R '@RG\tID:S1\tLB:S1\tPL:S1\tSM:S1' gmx.fa S1_filter_1.fq.gz S1_filter_2.fq.gz | samtools view -bS - -o S1.bam
samtools index S1.bam
java -jar picard.jar SortSam I=S1.bam O=S1.sort.bam SO=coordinate
java -jar GenomeAnalysisTK.jar -T RealignerTargetCreator -R gmx.fa -I S1.sort.bam -o S1.sort.bam.intervals
java -jar GenomeAnalysisTK.jar -T IndelRealigner -R gmx.fa -I S1.clean.bam -targetIntervals S1.clean.bam.intervals -o S1.clean.realign.bam -rf MappingQualityZero 

#Get variation from the bam files
java -jar GenomeAnalysisTK.jar -T UnifiedGenotyper -glm BOTH -R gmx.fa -nt 30  -I S1.final.bam -I S2.final.bam -I S3.final.bam -I S4.final.bam -I S5.final.bam .... -o all.vcf
